<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lara Control Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        :root { --glide-blue: #007aff; --glide-bg: #f2f2f7; }
        body { background-color: var(--glide-bg); font-family: -apple-system, system-ui, sans-serif; margin: 0; padding-bottom: 100px; color: #1c1c1e; }
        
        .card { background: white; border-radius: 20px; padding: 20px; margin-bottom: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.02); }
        .header { background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; padding: 15px 20px; border-bottom: 1px solid #e5e5ea; display: flex; justify-content: space-between; align-items: center; }
        
        label { display: block; font-size: 11px; font-weight: 600; color: #8e8e93; text-transform: uppercase; margin: 0 0 6px 4px; }
        input, select, textarea { width: 100%; background: #f2f2f7; border: none; border-radius: 12px; padding: 12px; font-size: 16px; margin-bottom: 15px; box-sizing: border-box; -webkit-appearance: none; }
        input:focus { background: #e5e5ea; outline: none; }
        
        .btn-main { background: var(--glide-blue); color: white; border: none; width: 100%; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 700; cursor: pointer; transition: opacity 0.2s; }
        .btn-main:active { opacity: 0.7; transform: scale(0.99); }
        .btn-diezmo { background: #34c759; }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e5ea; display: flex; padding-bottom: env(safe-area-inset-bottom); z-index: 1000; }
        .nav-item { flex: 1; text-align: center; padding: 10px 0; color: #8e8e93; background: none; border: none; font-size: 10px; font-weight: 500; display: flex; flex-direction: column; align-items: center; }
        .nav-item.active { color: var(--glide-blue); }
        .nav-item i { margin-bottom: 4px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <header class="header">
        <div>
            <span style="color: var(--glide-blue); font-size: 10px; font-weight: 800; letter-spacing: 1px;">LARA CONTROL</span>
            <h1 id="view-title" style="margin:0; font-size: 20px; font-weight: 800;">Registros</h1>
        </div>
        <img src="aa.jpg" style="width: 42px; height: 42px; border-radius: 12px; object-fit: cover; background: #eee;">
    </header>

    <main style="padding: 16px;">
        
        <div id="sec-registros" class="content-sec">
            <div class="card">
                <label>Fecha</label>
                <input type="date" id="reg-fecha">
                <label>Tipo</label>
                <select id="reg-tipo"><option value="Ingreso">üü¢ Ingreso</option><option value="Gasto">üî¥ Gasto</option></select>
                <label>Categor√≠a</label>
                <select id="reg-cat">
                    <option>Uber Diario</option><option>Renta Carro</option><option>Gasolina</option>
                    <option>Mantenimiento</option><option>Internet</option><option>Privado</option><option>Otros</option>
                </select>
                <label>Monto $</label>
                <input type="number" id="reg-monto" placeholder="0.00" inputmode="decimal">
                <label>Nota</label>
                <input type="text" id="reg-nota" placeholder="Opcional">
                <button onclick="guardarMovimiento()" class="btn-main">Guardar Registro</button>
            </div>
        </div>

        <div id="sec-viajes" class="content-sec hidden">
            <div class="card">
                <label>Cliente</label>
                <input type="text" id="v-cliente" placeholder="Nombre">
                <label>Costo del Viaje</label>
                <input type="number" id="v-costo" placeholder="$0.00">
                <label>Estado</label>
                <select id="v-estado">
                    <option>Cotizaci√≥n</option><option>Agendado</option><option>Realizado</option>
                </select>
                <button onclick="guardarViaje()" class="btn-main">Agendar Viaje</button>
            </div>
            <div id="lista-viajes"></div>
        </div>

        <div id="sec-diezmos" class="content-sec hidden">
            <div id="card-diezmo-calculo" class="card" style="text-align: center; background: linear-gradient(135deg, #007aff, #5856d6); color: white;">
                </div>
            <div class="card">
                <label>Monto a abonar</label>
                <input type="number" id="d-pago" placeholder="$0.00">
                <button onclick="guardarDiezmo()" class="btn-main btn-diezmo">Registrar Pago</button>
            </div>
        </div>

        <div id="sec-balance" class="content-sec hidden">
            <div id="balance-total"></div>
            <div class="card" style="padding: 10px;">
                <button onclick="exportarDatos()" style="background: none; border: none; color: #8e8e93; width: 100%; font-size: 12px;">Resetear Aplicaci√≥n (Borrar todo)</button>
            </div>
        </div>

    </main>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="nav('registros')"><i data-lucide="plus-circle"></i>Nuevo</button>
        <button class="nav-item" onclick="nav('viajes')"><i data-lucide="map-pin"></i>Viajes</button>
        <button class="nav-item" onclick="nav('diezmos')"><i data-lucide="heart"></i>Diezmos</button>
        <button class="nav-item" onclick="nav('balance')"><i data-lucide="pie-chart"></i>Balance</button>
    </nav>

    <script>
        lucide.createIcons();
        document.getElementById('reg-fecha').valueAsDate = new Date();

        // BASE DE DATOS √öNICA
        let LARA_DB = JSON.parse(localStorage.getItem('LARA_STORAGE_V1')) || { registros: [], viajes: [], diezmos: [] };

        function nav(id) {
            document.querySelectorAll('.content-sec').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('sec-'+id).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            document.getElementById('view-title').innerText = id.charAt(0).toUpperCase() + id.slice(1);
            if(id === 'balance') actualizarBalance();
            if(id === 'diezmos') actualizarDiezmos();
        }

        function guardarMovimiento() {
            const monto = document.getElementById('reg-monto').value;
            if(!monto) return alert("Ingresa un monto");
            
            LARA_DB.registros.push({
                fecha: document.getElementById('reg-fecha').value,
                tipo: document.getElementById('reg-tipo').value,
                cat: document.getElementById('reg-cat').value,
                monto: parseFloat(monto),
                nota: document.getElementById('reg-nota').value
            });
            
            persistir();
            alert("‚úÖ Registro Guardado");
            document.getElementById('reg-monto').value = "";
        }

        function guardarViaje() {
            const cliente = document.getElementById('v-cliente').value;
            const costo = document.getElementById('v-costo').value;
            if(!cliente || !costo) return alert("Faltan datos");

            LARA_DB.viajes.push({ cliente, costo: parseFloat(costo), estado: document.getElementById('v-estado').value });
            persistir();
            alert("‚úÖ Viaje Guardado");
            document.getElementById('v-cliente').value = "";
            document.getElementById('v-costo').value = "";
        }

        function actualizarBalance() {
            let ingresos = 0, gastos = 0;
            LARA_DB.registros.forEach(r => {
                if(r.tipo === 'Ingreso') ingresos += r.monto; else gastos += r.monto;
            });
            const neto = ingresos - gastos;
            
            document.getElementById('balance-total').innerHTML = `
                <div class="card" style="text-align: center; border-bottom: 5px solid var(--glide-blue);">
                    <label>Balance Neto</label>
                    <h2 style="font-size: 36px; margin:0;">$${neto.toLocaleString()}</h2>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="card" style="flex:1; text-align:center;"><label>Ingresos</label><p style="color:#34c759; font-weight:700;">$${ingresos.toLocaleString()}</p></div>
                    <div class="card" style="flex:1; text-align:center;"><label>Gastos</label><p style="color:#ff3b30; font-weight:700;">$${gastos.toLocaleString()}</p></div>
                </div>
            `;
        }

        function actualizarDiezmos() {
            let ingresos = 0, gastos = 0;
            LARA_DB.registros.forEach(r => { if(r.tipo === 'Ingreso') ingresos += r.monto; else gastos += r.monto; });
            const neto = ingresos - gastos;
            const sugerido = neto > 0 ? neto * 0.10 : 0;
            const pagado = LARA_DB.diezmos.reduce((a, b) => a + b, 0);

            document.getElementById('card-diezmo-calculo').innerHTML = `
                <label style="color:white; opacity:0.8;">Sugerido (10%)</label>
                <h2 style="font-size: 40px; margin:5px 0;">$${sugerido.toLocaleString()}</h2>
                <p style="font-size: 12px;">Pendiente: $${(sugerido - pagado).toLocaleString()}</p>
            `;
        }

        function guardarDiezmo() {
            const monto = document.getElementById('d-pago').value;
            if(!monto) return;
            LARA_DB.diezmos.push(parseFloat(monto));
            persistir();
            actualizarDiezmos();
            document.getElementById('d-pago').value = "";
            alert("üôè Diezmo registrado");
        }

        function persistir() {
            localStorage.setItem('LARA_STORAGE_V1', JSON.stringify(LARA_DB));
        }

        function exportarDatos() {
            if(confirm("¬øBorrar todos los datos permanentemente?")) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
