<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lara Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        :root { --primary: #3b82f6; --bg: #0f172a; }
        body { background-color: var(--bg); color: #f1f5f9; font-family: 'Segoe UI', sans-serif; margin:0; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .nav-btn { display: flex; flex-direction: column; align-items: center; font-size: 0.65rem; color: #94a3b8; flex: 1; padding: 10px 0; border:none; background:none; }
        .nav-active { color: var(--primary); }
        input, select, textarea { background: #1e293b !important; border: 1px solid #334155 !important; color: white !important; padding: 0.8rem; border-radius: 0.6rem; width: 100%; font-size: 16px; margin-bottom: 8px; }
        .btn-blue { background: #2563eb; color: white; font-weight: bold; padding: 1rem; border-radius: 0.6rem; width: 100%; transition: 0.2s; border: none; cursor: pointer; }
        .btn-blue:active { background: #1d4ed8; transform: scale(0.98); }
    </style>
</head>
<body class="pb-24">

    <div id="welcome" class="fixed inset-0 z-50 bg-[#0f172a] flex flex-col items-center justify-center p-6 text-center">
        <div class="w-32 h-32 bg-white p-4 rounded-3xl mb-6 shadow-2xl">
            <img src="logo.jpg" alt="Logo" class="w-full h-full object-contain">
        </div>
        <h1 class="text-3xl font-black mb-2 uppercase">LARA CONTROL</h1>
        <p class="text-slate-400 mb-10">Control Profesional de Gastos</p>
        <button onclick="document.getElementById('welcome').style.display='none'" class="btn-blue w-full max-w-xs">ENTRAR</button>
    </div>

    <header class="p-4 flex justify-between items-center glass sticky top-0 z-30">
        <span id="section-title" class="font-bold text-blue-400 uppercase tracking-tighter text-sm">REGISTROS</span>
        <img src="logo.jpg" class="h-8 w-8 rounded-lg object-cover bg-white">
    </header>

    <main class="p-4 max-w-md mx-auto">
        <section id="sec-registros" class="space-y-4">
            <div class="glass p-5 rounded-2xl">
                <label class="text-[10px] font-bold text-slate-500 uppercase">Fecha</label>
                <input type="date" id="reg-fecha">
                
                <label class="text-[10px] font-bold text-slate-500 uppercase">Tipo de Flujo</label>
                <select id="reg-tipo-flujo">
                    <option value="Ingreso">üü¢ Ingreso</option>
                    <option value="Gasto">üî¥ Gasto</option>
                </select>
                
                <label class="text-[10px] font-bold text-slate-500 uppercase">Categor√≠a</label>
                <select id="reg-categoria">
                    <option value="Uber Diario">üöï Uber Diario</option>
                    <option value="Renta Carro">üîë Renta Carro</option>
                    <option value="Mantenimiento">üõ†Ô∏è Mantenimiento</option>
                    <option value="Internet">üåê Internet</option>
                    <option value="Gasolina">‚õΩ Gasolina</option>
                    <option value="Privado">üë§ Privado</option>
                    <option value="Otros">üì¶ Otros</option>
                </select>
                
                <label class="text-[10px] font-bold text-slate-500 uppercase">Monto ($)</label>
                <input type="number" id="reg-monto" placeholder="0.00" inputmode="decimal">
                
                <textarea id="reg-concepto" placeholder="Notas adicionales..."></textarea>
                
                <button type="button" onclick="saveRegistro()" class="btn-blue mt-2">GUARDAR REGISTRO</button>
            </div>
        </section>

        <section id="sec-viajes" class="hidden space-y-4">
            <div class="glass p-5 rounded-2xl">
                <input type="text" id="v-cliente" placeholder="Cliente">
                <input type="text" id="v-inicio" placeholder="Origen">
                <input type="text" id="v-fin" placeholder="Destino">
                <input type="number" id="v-costo" placeholder="Costo $">
                <input type="date" id="v-fecha">
                <select id="v-tipo">
                    <option value="Cotizaci√≥n">üìÑ Cotizaci√≥n</option>
                    <option value="Agendado">üìÖ Agendado</option>
                    <option value="Realizado">‚úÖ Realizado</option>
                </select>
                <button type="button" onclick="saveViaje()" class="btn-blue">GUARDAR VIAJE</button>
            </div>
        </section>

        <section id="sec-diezmos" class="hidden space-y-4">
            <div id="diezmo-info" class="glass p-5 rounded-2xl bg-blue-900/20 border-blue-500/30"></div>
            <div class="glass p-5 rounded-2xl">
                <input type="number" id="d-pago" placeholder="Monto a pagar $">
                <button type="button" onclick="saveDiezmo()" class="w-full bg-emerald-600 py-4 rounded-xl font-bold">REGISTRAR PAGO</button>
            </div>
        </section>

        <section id="sec-resumen" class="hidden space-y-4">
            <div id="resumen-container"></div>
            <button onclick="borrarDatos()" class="w-full text-red-500 text-[10px] opacity-30 mt-10">BORRAR TODOS LOS DATOS</button>
        </section>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-[#1e293b] border-t border-slate-700 flex p-1 z-40">
        <button onclick="nav('registros')" id="n-registros" class="nav-btn nav-active"><i data-lucide="pen-tool"></i>Reg.</button>
        <button onclick="nav('viajes')" id="n-viajes" class="nav-btn"><i data-lucide="car"></i>Viajes</button>
        <button onclick="nav('diezmos')" id="n-diezmos" class="nav-btn"><i data-lucide="heart"></i>Diezmos</button>
        <button onclick="nav('resumen')" id="n-resumen" class="nav-btn"><i data-lucide="bar-chart-3"></i>Resumen</button>
    </nav>

    <script>
        lucide.createIcons();
        document.getElementById('reg-fecha').valueAsDate = new Date();
        document.getElementById('v-fecha').valueAsDate = new Date();

        // Base de datos local
        let db = JSON.parse(localStorage.getItem('lara_final_db')) || { registros: [], viajes: [], diezmos: [] };

        function saveDB() { localStorage.setItem('lara_final_db', JSON.stringify(db)); }

        function nav(s) {
            ['registros', 'viajes', 'diezmos', 'resumen'].forEach(sec => {
                document.getElementById('sec-'+sec).classList.add('hidden');
                document.getElementById('n-'+sec).classList.remove('nav-active');
            });
            document.getElementById('sec-'+s).classList.remove('hidden');
            document.getElementById('n-'+s).classList.add('nav-active');
            document.getElementById('section-title').innerText = s.toUpperCase();
            if(s === 'resumen') updateResumen();
            if(s === 'diezmos') updateDiezmosView();
        }

        function saveRegistro() {
            const monto = parseFloat(document.getElementById('reg-monto').value);
            if(!monto) { alert("Por favor ingresa un monto"); return; }
            
            db.registros.push({
                fecha: document.getElementById('reg-fecha').value,
                flujo: document.getElementById('reg-tipo-flujo').value,
                cat: document.getElementById('reg-categoria').value,
                monto: monto,
                concepto: document.getElementById('reg-concepto').value
            });
            
            saveDB();
            alert("‚úÖ Guardado correctamente");
            document.getElementById('reg-monto').value = '';
            document.getElementById('reg-concepto').value = '';
        }

        function saveViaje() {
            db.viajes.push({
                cliente: document.getElementById('v-cliente').value,
                costo: parseFloat(document.getElementById('v-costo').value) || 0,
                fecha: document.getElementById('v-fecha').value,
                tipo: document.getElementById('v-tipo').value
            });
            saveDB(); alert("‚úÖ Viaje guardado");
        }

        function updateResumen() {
            const hoy = new Date();
            const day = hoy.getDay() || 7;
            const lunes = new Date(hoy); lunes.setDate(hoy.getDate() - day + 1); lunes.setHours(0,0,0,0);
            const dom = new Date(lunes); dom.setDate(lunes.getDate() + 6); dom.setHours(23,59,59,999);

            let ing = 0, gas = 0;
            db.registros.forEach(r => {
                const f = new Date(r.fecha + 'T00:00:00');
                if(f >= lunes && f <= dom) {
                    if(r.flujo === 'Ingreso') ing += r.monto; else gas += r.monto;
                }
            });
            
            const neta = ing - gas;
            document.getElementById('resumen-container').innerHTML = `
                <div class="glass p-6 rounded-3xl text-center border-b-4 border-blue-500 mb-4">
                    <p class="text-slate-400 text-[10px] uppercase">Ganancia Neta Semanal</p>
                    <h4 class="text-4xl font-black text-blue-400 my-2">$${neta.toFixed(2)}</h4>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="glass p-4 rounded-2xl text-center"><p class="text-[10px] text-slate-400">INGRESOS</p><p class="text-lg font-bold text-emerald-400">$${ing.toFixed(2)}</p></div>
                    <div class="glass p-4 rounded-2xl text-center"><p class="text-[10px] text-slate-400">GASTOS</p><p class="text-lg font-bold text-red-400">$${gas.toFixed(2)}</p></div>
                </div>`;
            return neta;
        }

        function updateDiezmosView() {
            const neta = updateResumen();
            const sug = neta > 0 ? neta * 0.10 : 0;
            
            const hoy = new Date();
            const day = hoy.getDay() || 7;
            const lun = new Date(hoy); lun.setDate(hoy.getDate() - day + 1); lun.setHours(0,0,0,0);
            const dom = new Date(lun); dom.setDate(lun.getDate() + 6); dom.setHours(23,59,59,999);

            let pagado = db.diezmos.reduce((acc, d) => {
                const f = new Date(d.fecha);
                return (f >= lun && f <= dom) ? acc + d.monto : acc;
            }, 0);

            document.getElementById('diezmo-info').innerHTML = `
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between"><span>Neta Semanal:</span><b>$${neta.toFixed(2)}</b></div>
                    <div class="flex justify-between text-blue-400"><span>Diezmo (10%):</span><b>$${sug.toFixed(2)}</b></div>
                    <div class="flex justify-between text-emerald-400 border-t border-white/10 pt-2"><span>Pagado:</span><b>$${pagado.toFixed(2)}</b></div>
                    <div class="flex justify-between text-red-400 font-black text-lg"><span>FALTANTE:</span><span>$${Math.max(0, sug - pagado).toFixed(2)}</span></div>
                </div>`;
        }

        function saveDiezmo() {
            const m = parseFloat(document.getElementById('d-pago').value);
            if(!m) return;
            db.diezmos.push({ monto: m, fecha: new Date().toISOString() });
            saveDB(); updateDiezmosView();
            document.getElementById('d-pago').value = '';
            alert("üôè Diezmo registrado");
        }

        function borrarDatos() { if(confirm("¬øSeguro que quieres borrar todo?")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
